# [BLOQUE DIDACTICO] docker-compose.yml
# Que es: Orquestacion local de servicios con Docker Compose.
# Que hace: Levanta contenedores necesarios para entorno de desarrollo/prueba.
# Como lo hace: Define servicios, dependencias, puertos, variables y healthchecks.

services:
  mongo:
    image: mongo:7
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - mongo-data:/data/db

  backend:
    build:
      context: ./server
      dockerfile: Dockerfile
    restart: unless-stopped
    depends_on:
      mongo:
        condition: service_healthy
    environment:
      PUERTO: ${PUERTO:-3000}
      MONGODB_URI: ${MONGODB_URI:-mongodb://mongo:27017/mern-login}
      JWT_SECRETO: ${JWT_SECRETO:-cuh_sistemas_2026}
      ORIGEN_CORS: ${ORIGEN_CORS:-http://localhost:5173}
      NODE_ENV: ${NODE_ENV:-development}
    ports:
      - "${BACKEND_PORT:-3001}:3000"
    volumes:
      - ./server/src:/app/src

volumes:
  mongo-data:
